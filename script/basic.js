if(!window.localStorage){if(typeof(widget)==='undefined'){Object.defineProperty(window,"localStorage",new(function(){var aKeys=[],oStorage={};Object.defineProperty(oStorage,"getItem",{value:function(sKey){return sKey?this[sKey]:null;},writable:false,configurable:false,enumerable:false});Object.defineProperty(oStorage,"key",{value:function(nKeyId){return aKeys[nKeyId];},writable:false,configurable:false,enumerable:false});Object.defineProperty(oStorage,"setItem",{value:function(sKey,sValue){if(!sKey){return;}document.cookie=escape(sKey)+"="+escape(sValue)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/";},writable:false,configurable:false,enumerable:false});Object.defineProperty(oStorage,"length",{get:function(){return aKeys.length;},configurable:false,enumerable:false});Object.defineProperty(oStorage,"removeItem",{value:function(sKey){if(!sKey){return;}document.cookie=escape(sKey)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";},writable:false,configurable:false,enumerable:false});this.get=function(){var iThisIndx;for(var sKey in oStorage){iThisIndx=aKeys.indexOf(sKey);if(iThisIndx===-1){oStorage.setItem(sKey,oStorage[sKey]);}else{aKeys.splice(iThisIndx,1);};delete oStorage[sKey];};for(aKeys;aKeys.length>0;aKeys.splice(0,1)){oStorage.removeItem(aKeys[0]);};for(var aCouple,iKey,nIdx=0,aCouples=document.cookie.split(/\s*;\s*/);nIdx<aCouples.length;nIdx++){aCouple=aCouples[nIdx].split(/\s*=\s*/);if(aCouple.length>1){oStorage[iKey=unescape(aCouple[0])]=unescape(aCouple[1]);aKeys.push(iKey);}};return oStorage;};this.configurable=false;this.enumerable=true;})());}else{window.localStorage={getItem:function(sKey){return widget.preferenceForKey(sKey);},setItem:function(sKey,sValue){widget.setPreferenceForKey(sValue,sKey);},length:0,removeItem:function(sKey){widget.setPreferenceForKey(null,sKey);},hasOwnProperty:function(sKey){return widget.preferenceForKey(sKey)!==null;}};}};jQuery.fn.motionCaptcha||(function($){$.fn.motionCaptcha=function(options){return this.each(function(){var opts=$.extend({},$.fn.motionCaptcha.defaults,options);opts.actionId='#'+opts.actionId.replace(/\#/g,'');opts.canvasId='#'+opts.canvasId.replace(/\#/g,'');opts.divId='#'+opts.divId.replace(/\#/g,'');opts.submitId=(opts.submitId)?'#'+opts.submitId.replace(/\#/g,''):false;var brush,locked=false;var$body=$('body'),$form=$(this),$container=$(opts.divId),$canvas=$(opts.canvasId);var canvasWidth=$canvas.width(),canvasHeight=$canvas.height(),borderLeftWidth=1*$canvas.css('borderLeftWidth').replace('px',''),borderTopWidth=1*$canvas.css('borderTopWidth').replace('px','');$canvas[0].width=canvasWidth;$canvas[0].height=canvasHeight;var ctx=$canvas[0].getContext("2d");ctx.canvasWidth=canvasWidth;ctx.canvasHeight=canvasHeight;ctx.font=opts.canvasFont;ctx.fillStyle=opts.canvasTextColor;$canvas.addClass(opts.shapes[Math.floor(Math.random()*(opts.shapes.length))]);var _isDown=false,_holdStill=false,_points=[],_r=new DollarRecognizer();brush=new Ribbon(ctx);var touchStartEvent=function(event){if(locked)return false;event.preventDefault();var pos=getPos(event),x=pos[0],y=pos[1];_isDown=true;_holdStill=true;$('body').addClass('mc-noselect');ctx.clearRect(0,0,canvasWidth,canvasHeight);brush.strokeStart(x,y);$canvas.removeClass('mc-invalid mc-valid');_points=[NewPoint(x,y)];return false;};var touchMoveEvent=function(event){if(_holdStill){return _holdStill=0;}if(!locked&&_isDown){event.preventDefault();var pos=getPos(event),x=pos[0],y=pos[1];_points[_points.length]=NewPoint(x,y);brush.stroke(x,y);}return false;};var touchEndEvent=function(event){if(!locked&&_isDown){_isDown=false;$('body').removeClass('mc-noselect');if(_points.length>=10){var result=_r.Recognize(_points);if($canvas.attr('class').match(result.Name)&&result.Score>0.7){locked=1;setTimeout(brush.destroy,500);$canvas.addClass('mc-valid');ctx.fillText(opts.successMsg,10,24);opts.onSuccess($form,$canvas,ctx);}else{$canvas.addClass('mc-invalid');ctx.fillText(opts.errorMsg,10,24);opts.onError($form,$canvas,ctx);}}else{$canvas.addClass('mc-invalid');ctx.fillText(opts.errorMsg,10,24);opts.onError($form,$canvas,ctx);}};return false;};$canvas.bind({mousedown:touchStartEvent,mousemove:touchMoveEvent,mouseup:touchEndEvent});$canvas[0].addEventListener('touchstart',touchStartEvent,false);$canvas[0].addEventListener('touchmove',touchMoveEvent,false);$canvas[0].addEventListener('touchend',touchEndEvent,false);$canvas.addClass(opts.cssClass.replace(/\./,''));function getPos(event){var x,y;if(event.touches&&event.touches.length>0){x=event.touches[0].pageX-$canvas.offset().left+borderLeftWidth;y=event.touches[0].pageY-$canvas.offset().top+borderTopWidth;}else if(event.offsetX){x=event.offsetX-borderLeftWidth;y=event.offsetY-borderTopWidth;}else{x=event.pageX-$canvas.offset().left-borderLeftWidth;y=event.pageY-$canvas.offset().top-borderTopWidth;};return[x,y];}});};$.fn.motionCaptcha.defaults={actionId:'#mc-action',divId:'#mc',canvasId:'#mc-canvas',submitId:false,cssClass:'.mc-active',shapes:['triangle','x','rectangle','circle','check','caret','zigzag','arrow','leftbracket','rightbracket','v','delete','star','pigtail'],canvasFont:'15px "Lucida Grande"',canvasTextColor:'#111',errorMsg:'Please try again.',successMsg:'Captcha passed!',noCanvasMsg:"Your browser doesn't support <canvas> - try Chrome, FF4, Safari or IE9.",label:'<p>Please draw the shape in the box to submit the form:</p>',onSuccess:function($form,$canvas,ctx){var opts=this,$submit=opts.submitId?$form.find(opts.submitId):$form.find('input[type=submit]:disabled');$form.attr('action',$(opts.actionId).val());$submit.prop('disabled',false);$submit.parent().removeClass('ui-disabled');return;},onError:function($form,$canvas,ctx){var opts=this;return;}};function Ribbon(ctx){this.init(ctx);};Ribbon.prototype={ctx:null,X:null,Y:null,painters:null,interval:null,init:function(ctx){var scope=this,userAgent=navigator.userAgent.toLowerCase(),brushSize=(userAgent.search("android")>-1||userAgent.search("iphone")>-1)?2:1,strokeColor=[0,0,0];this.ctx=ctx;this.ctx.globalCompositeOperation='source-over';this.X=this.ctx.canvasWidth/2;this.Y=this.ctx.canvasHeight/2;this.painters=[];for(var i=0;i<38;i++){this.painters.push({dx:this.ctx.canvasWidth/2,dy:this.ctx.canvasHeight/2,ax:0,ay:0,div:0.1,ease:Math.random()*0.18+0.60});}this.interval=setInterval(update,1000/60);function update(){var i;scope.ctx.lineWidth=brushSize;scope.ctx.strokeStyle="rgba("+strokeColor[0]+", "+strokeColor[1]+", "+strokeColor[2]+", "+0.06+")";for(i=0;i<scope.painters.length;i++){scope.ctx.beginPath();scope.ctx.moveTo(scope.painters[i].dx,scope.painters[i].dy);scope.painters[i].dx-=scope.painters[i].ax=(scope.painters[i].ax+(scope.painters[i].dx-scope.X)*scope.painters[i].div)*scope.painters[i].ease;scope.painters[i].dy-=scope.painters[i].ay=(scope.painters[i].ay+(scope.painters[i].dy-scope.Y)*scope.painters[i].div)*scope.painters[i].ease;scope.ctx.lineTo(scope.painters[i].dx,scope.painters[i].dy);scope.ctx.stroke();}}},destroy:function(){clearInterval(this.interval);},strokeStart:function(X,Y){this.X=X;this.Y=Y;for(var i=0;i<this.painters.length;i++){this.painters[i].dx=X;this.painters[i].dy=Y;}this.shouldDraw=true;},stroke:function(X,Y){this.X=X;this.Y=Y;}};function Point(x,y){this.X=x;this.Y=y;};function NewPoint(x,y){return new Point(x,y)};function Rectangle(x,y,width,height){this.X=x;this.Y=y;this.Width=width;this.Height=height;};function Template(name,points){this.Name=name;this.Points=Resample(points,NumPoints);var radians=IndicativeAngle(this.Points);this.Points=RotateBy(this.Points,-radians);this.Points=ScaleTo(this.Points,SquareSize);this.Points=TranslateTo(this.Points,Origin);this.Vector=Vectorize(this.Points);};function Result(name,score){this.Name=name;this.Score=score;};var NumTemplates=16,NumPoints=64,SquareSize=250.0,Origin=NewPoint(0,0);function DollarRecognizer(){this.Templates=[];this.Templates.push(new Template("triangle",[NewPoint(137,139),NewPoint(135,141),NewPoint(133,144),NewPoint(132,146),NewPoint(130,149),NewPoint(128,151),NewPoint(126,155),NewPoint(123,160),NewPoint(120,166),NewPoint(116,171),NewPoint(112,177),NewPoint(107,183),NewPoint(102,188),NewPoint(100,191),NewPoint(95,195),NewPoint(90,199),NewPoint(86,203),NewPoint(82,206),NewPoint(80,209),NewPoint(75,213),NewPoint(73,213),NewPoint(70,216),NewPoint(67,219),NewPoint(64,221),NewPoint(61,223),NewPoint(60,225),NewPoint(62,226),NewPoint(65,225),NewPoint(67,226),NewPoint(74,226),NewPoint(77,227),NewPoint(85,229),NewPoint(91,230),NewPoint(99,231),NewPoint(108,232),NewPoint(116,233),NewPoint(125,233),NewPoint(134,234),NewPoint(145,233),NewPoint(153,232),NewPoint(160,233),NewPoint(170,234),NewPoint(177,235),NewPoint(179,236),NewPoint(186,237),NewPoint(193,238),NewPoint(198,239),NewPoint(200,237),NewPoint(202,239),NewPoint(204,238),NewPoint(206,234),NewPoint(205,230),NewPoint(202,222),NewPoint(197,216),NewPoint(192,207),NewPoint(186,198),NewPoint(179,189),NewPoint(174,183),NewPoint(170,178),NewPoint(164,171),NewPoint(161,168),NewPoint(154,160),NewPoint(148,155),NewPoint(143,150),NewPoint(138,148),NewPoint(136,148)]));this.Templates.push(new Template("x",[NewPoint(87,142),NewPoint(89,145),NewPoint(91,148),NewPoint(93,151),NewPoint(96,155),NewPoint(98,157),NewPoint(100,160),NewPoint(102,162),NewPoint(106,167),NewPoint(108,169),NewPoint(110,171),NewPoint(115,177),NewPoint(119,183),NewPoint(123,189),NewPoint(127,193),NewPoint(129,196),NewPoint(133,200),NewPoint(137,206),NewPoint(140,209),NewPoint(143,212),NewPoint(146,215),NewPoint(151,220),NewPoint(153,222),NewPoint(155,223),NewPoint(157,225),NewPoint(158,223),NewPoint(157,218),NewPoint(155,211),NewPoint(154,208),NewPoint(152,200),NewPoint(150,189),NewPoint(148,179),NewPoint(147,170),NewPoint(147,158),NewPoint(147,148),NewPoint(147,141),NewPoint(147,136),NewPoint(144,135),NewPoint(142,137),NewPoint(140,139),NewPoint(135,145),NewPoint(131,152),NewPoint(124,163),NewPoint(116,177),NewPoint(108,191),NewPoint(100,206),NewPoint(94,217),NewPoint(91,222),NewPoint(89,225),NewPoint(87,226),NewPoint(87,224)]));this.Templates.push(new Template("rectangle",[NewPoint(78,149),NewPoint(78,153),NewPoint(78,157),NewPoint(78,160),NewPoint(79,162),NewPoint(79,164),NewPoint(79,167),NewPoint(79,169),NewPoint(79,173),NewPoint(79,178),NewPoint(79,183),NewPoint(80,189),NewPoint(80,193),NewPoint(80,198),NewPoint(80,202),NewPoint(81,208),NewPoint(81,210),NewPoint(81,216),NewPoint(82,222),NewPoint(82,224),NewPoint(82,227),NewPoint(83,229),NewPoint(83,231),NewPoint(85,230),NewPoint(88,232),NewPoint(90,233),NewPoint(92,232),NewPoint(94,233),NewPoint(99,232),NewPoint(102,233),NewPoint(106,233),NewPoint(109,234),NewPoint(117,235),NewPoint(123,236),NewPoint(126,236),NewPoint(135,237),NewPoint(142,238),NewPoint(145,238),NewPoint(152,238),NewPoint(154,239),NewPoint(165,238),NewPoint(174,237),NewPoint(179,236),NewPoint(186,235),NewPoint(191,235),NewPoint(195,233),NewPoint(197,233),NewPoint(200,233),NewPoint(201,235),NewPoint(201,233),NewPoint(199,231),NewPoint(198,226),NewPoint(198,220),NewPoint(196,207),NewPoint(195,195),NewPoint(195,181),NewPoint(195,173),NewPoint(195,163),NewPoint(194,155),NewPoint(192,145),NewPoint(192,143),NewPoint(192,138),NewPoint(191,135),NewPoint(191,133),NewPoint(191,130),NewPoint(190,128),NewPoint(188,129),NewPoint(186,129),NewPoint(181,132),NewPoint(173,131),NewPoint(162,131),NewPoint(151,132),NewPoint(149,132),NewPoint(138,132),NewPoint(136,132),NewPoint(122,131),NewPoint(120,131),NewPoint(109,130),NewPoint(107,130),NewPoint(90,132),NewPoint(81,133),NewPoint(76,133)]));this.Templates.push(new Template("circle",[NewPoint(127,141),NewPoint(124,140),NewPoint(120,139),NewPoint(118,139),NewPoint(116,139),NewPoint(111,140),NewPoint(109,141),NewPoint(104,144),NewPoint(100,147),NewPoint(96,152),NewPoint(93,157),NewPoint(90,163),NewPoint(87,169),NewPoint(85,175),NewPoint(83,181),NewPoint(82,190),NewPoint(82,195),NewPoint(83,200),NewPoint(84,205),NewPoint(88,213),NewPoint(91,216),NewPoint(96,219),NewPoint(103,222),NewPoint(108,224),NewPoint(111,224),NewPoint(120,224),NewPoint(133,223),NewPoint(142,222),NewPoint(152,218),NewPoint(160,214),NewPoint(167,210),NewPoint(173,204),NewPoint(178,198),NewPoint(179,196),NewPoint(182,188),NewPoint(182,177),NewPoint(178,167),NewPoint(170,150),NewPoint(163,138),NewPoint(152,130),NewPoint(143,129),NewPoint(140,131),NewPoint(129,136),NewPoint(126,139)]));this.Templates.push(new Template("check",[NewPoint(91,185),NewPoint(93,185),NewPoint(95,185),NewPoint(97,185),NewPoint(100,188),NewPoint(102,189),NewPoint(104,190),NewPoint(106,193),NewPoint(108,195),NewPoint(110,198),NewPoint(112,201),NewPoint(114,204),NewPoint(115,207),NewPoint(117,210),NewPoint(118,212),NewPoint(120,214),NewPoint(121,217),NewPoint(122,219),NewPoint(123,222),NewPoint(124,224),NewPoint(126,226),NewPoint(127,229),NewPoint(129,231),NewPoint(130,233),NewPoint(129,231),NewPoint(129,228),NewPoint(129,226),NewPoint(129,224),NewPoint(129,221),NewPoint(129,218),NewPoint(129,212),NewPoint(129,208),NewPoint(130,198),NewPoint(132,189),NewPoint(134,182),NewPoint(137,173),NewPoint(143,164),NewPoint(147,157),NewPoint(151,151),NewPoint(155,144),NewPoint(161,137),NewPoint(165,131),NewPoint(171,122),NewPoint(174,118),NewPoint(176,114),NewPoint(177,112),NewPoint(177,114),NewPoint(175,116),NewPoint(173,118)]));this.Templates.push(new Template("caret",[NewPoint(79,245),NewPoint(79,242),NewPoint(79,239),NewPoint(80,237),NewPoint(80,234),NewPoint(81,232),NewPoint(82,230),NewPoint(84,224),NewPoint(86,220),NewPoint(86,218),NewPoint(87,216),NewPoint(88,213),NewPoint(90,207),NewPoint(91,202),NewPoint(92,200),NewPoint(93,194),NewPoint(94,192),NewPoint(96,189),NewPoint(97,186),NewPoint(100,179),NewPoint(102,173),NewPoint(105,165),NewPoint(107,160),NewPoint(109,158),NewPoint(112,151),NewPoint(115,144),NewPoint(117,139),NewPoint(119,136),NewPoint(119,134),NewPoint(120,132),NewPoint(121,129),NewPoint(122,127),NewPoint(124,125),NewPoint(126,124),NewPoint(129,125),NewPoint(131,127),NewPoint(132,130),NewPoint(136,139),NewPoint(141,154),NewPoint(145,166),NewPoint(151,182),NewPoint(156,193),NewPoint(157,196),NewPoint(161,209),NewPoint(162,211),NewPoint(167,223),NewPoint(169,229),NewPoint(170,231),NewPoint(173,237),NewPoint(176,242),NewPoint(177,244),NewPoint(179,250),NewPoint(181,255),NewPoint(182,257)]));this.Templates.push(new Template("zigzag",[NewPoint(307,216),NewPoint(333,186),NewPoint(356,215),NewPoint(375,186),NewPoint(399,216),NewPoint(418,186)]));this.Templates.push(new Template("arrow",[NewPoint(68,222),NewPoint(70,220),NewPoint(73,218),NewPoint(75,217),NewPoint(77,215),NewPoint(80,213),NewPoint(82,212),NewPoint(84,210),NewPoint(87,209),NewPoint(89,208),NewPoint(92,206),NewPoint(95,204),NewPoint(101,201),NewPoint(106,198),NewPoint(112,194),NewPoint(118,191),NewPoint(124,187),NewPoint(127,186),NewPoint(132,183),NewPoint(138,181),NewPoint(141,180),NewPoint(146,178),NewPoint(154,173),NewPoint(159,171),NewPoint(161,170),NewPoint(166,167),NewPoint(168,167),NewPoint(171,166),NewPoint(174,164),NewPoint(177,162),NewPoint(180,160),NewPoint(182,158),NewPoint(183,156),NewPoint(181,154),NewPoint(178,153),NewPoint(171,153),NewPoint(164,153),NewPoint(160,153),NewPoint(150,154),NewPoint(147,155),NewPoint(141,157),NewPoint(137,158),NewPoint(135,158),NewPoint(137,158),NewPoint(140,157),NewPoint(143,156),NewPoint(151,154),NewPoint(160,152),NewPoint(170,149),NewPoint(179,147),NewPoint(185,145),NewPoint(192,144),NewPoint(196,144),NewPoint(198,144),NewPoint(200,144),NewPoint(201,147),NewPoint(199,149),NewPoint(194,157),NewPoint(191,160),NewPoint(186,167),NewPoint(180,176),NewPoint(177,179),NewPoint(171,187),NewPoint(169,189),NewPoint(165,194),NewPoint(164,196)]));this.Templates.push(new Template("leftbracket",[NewPoint(140,124),NewPoint(138,123),NewPoint(135,122),NewPoint(133,123),NewPoint(130,123),NewPoint(128,124),NewPoint(125,125),NewPoint(122,124),NewPoint(120,124),NewPoint(118,124),NewPoint(116,125),NewPoint(113,125),NewPoint(111,125),NewPoint(108,124),NewPoint(106,125),NewPoint(104,125),NewPoint(102,124),NewPoint(100,123),NewPoint(98,123),NewPoint(95,124),NewPoint(93,123),NewPoint(90,124),NewPoint(88,124),NewPoint(85,125),NewPoint(83,126),NewPoint(81,127),NewPoint(81,129),NewPoint(82,131),NewPoint(82,134),NewPoint(83,138),NewPoint(84,141),NewPoint(84,144),NewPoint(85,148),NewPoint(85,151),NewPoint(86,156),NewPoint(86,160),NewPoint(86,164),NewPoint(86,168),NewPoint(87,171),NewPoint(87,175),NewPoint(87,179),NewPoint(87,182),NewPoint(87,186),NewPoint(88,188),NewPoint(88,195),NewPoint(88,198),NewPoint(88,201),NewPoint(88,207),NewPoint(89,211),NewPoint(89,213),NewPoint(89,217),NewPoint(89,222),NewPoint(88,225),NewPoint(88,229),NewPoint(88,231),NewPoint(88,233),NewPoint(88,235),NewPoint(89,237),NewPoint(89,240),NewPoint(89,242),NewPoint(91,241),NewPoint(94,241),NewPoint(96,240),NewPoint(98,239),NewPoint(105,240),NewPoint(109,240),NewPoint(113,239),NewPoint(116,240),NewPoint(121,239),NewPoint(130,240),NewPoint(136,237),NewPoint(139,237),NewPoint(144,238),NewPoint(151,237),NewPoint(157,236),NewPoint(159,237)]));this.Templates.push(new Template("rightbracket",[NewPoint(112,138),NewPoint(112,136),NewPoint(115,136),NewPoint(118,137),NewPoint(120,136),NewPoint(123,136),NewPoint(125,136),NewPoint(128,136),NewPoint(131,136),NewPoint(134,135),NewPoint(137,135),NewPoint(140,134),NewPoint(143,133),NewPoint(145,132),NewPoint(147,132),NewPoint(149,132),NewPoint(152,132),NewPoint(153,134),NewPoint(154,137),NewPoint(155,141),NewPoint(156,144),NewPoint(157,152),NewPoint(158,161),NewPoint(160,170),NewPoint(162,182),NewPoint(164,192),NewPoint(166,200),NewPoint(167,209),NewPoint(168,214),NewPoint(168,216),NewPoint(169,221),NewPoint(169,223),NewPoint(169,228),NewPoint(169,231),NewPoint(166,233),NewPoint(164,234),NewPoint(161,235),NewPoint(155,236),NewPoint(147,235),NewPoint(140,233),NewPoint(131,233),NewPoint(124,233),NewPoint(117,235),NewPoint(114,238),NewPoint(112,238)]));this.Templates.push(new Template("v",[NewPoint(89,164),NewPoint(90,162),NewPoint(92,162),NewPoint(94,164),NewPoint(95,166),NewPoint(96,169),NewPoint(97,171),NewPoint(99,175),NewPoint(101,178),NewPoint(103,182),NewPoint(106,189),NewPoint(108,194),NewPoint(111,199),NewPoint(114,204),NewPoint(117,209),NewPoint(119,214),NewPoint(122,218),NewPoint(124,222),NewPoint(126,225),NewPoint(128,228),NewPoint(130,229),NewPoint(133,233),NewPoint(134,236),NewPoint(136,239),NewPoint(138,240),NewPoint(139,242),NewPoint(140,244),NewPoint(142,242),NewPoint(142,240),NewPoint(142,237),NewPoint(143,235),NewPoint(143,233),NewPoint(145,229),NewPoint(146,226),NewPoint(148,217),NewPoint(149,208),NewPoint(149,205),NewPoint(151,196),NewPoint(151,193),NewPoint(153,182),NewPoint(155,172),NewPoint(157,165),NewPoint(159,160),NewPoint(162,155),NewPoint(164,150),NewPoint(165,148),NewPoint(166,146)]));this.Templates.push(new Template("delete",[NewPoint(123,129),NewPoint(123,131),NewPoint(124,133),NewPoint(125,136),NewPoint(127,140),NewPoint(129,142),NewPoint(133,148),NewPoint(137,154),NewPoint(143,158),NewPoint(145,161),NewPoint(148,164),NewPoint(153,170),NewPoint(158,176),NewPoint(160,178),NewPoint(164,183),NewPoint(168,188),NewPoint(171,191),NewPoint(175,196),NewPoint(178,200),NewPoint(180,202),NewPoint(181,205),NewPoint(184,208),NewPoint(186,210),NewPoint(187,213),NewPoint(188,215),NewPoint(186,212),NewPoint(183,211),NewPoint(177,208),NewPoint(169,206),NewPoint(162,205),NewPoint(154,207),NewPoint(145,209),NewPoint(137,210),NewPoint(129,214),NewPoint(122,217),NewPoint(118,218),NewPoint(111,221),NewPoint(109,222),NewPoint(110,219),NewPoint(112,217),NewPoint(118,209),NewPoint(120,207),NewPoint(128,196),NewPoint(135,187),NewPoint(138,183),NewPoint(148,167),NewPoint(157,153),NewPoint(163,145),NewPoint(165,142),NewPoint(172,133),NewPoint(177,127),NewPoint(179,127),NewPoint(180,125)]));this.Templates.push(new Template("star",[NewPoint(75,250),NewPoint(75,247),NewPoint(77,244),NewPoint(78,242),NewPoint(79,239),NewPoint(80,237),NewPoint(82,234),NewPoint(82,232),NewPoint(84,229),NewPoint(85,225),NewPoint(87,222),NewPoint(88,219),NewPoint(89,216),NewPoint(91,212),NewPoint(92,208),NewPoint(94,204),NewPoint(95,201),NewPoint(96,196),NewPoint(97,194),NewPoint(98,191),NewPoint(100,185),NewPoint(102,178),NewPoint(104,173),NewPoint(104,171),NewPoint(105,164),NewPoint(106,158),NewPoint(107,156),NewPoint(107,152),NewPoint(108,145),NewPoint(109,141),NewPoint(110,139),NewPoint(112,133),NewPoint(113,131),NewPoint(116,127),NewPoint(117,125),NewPoint(119,122),NewPoint(121,121),NewPoint(123,120),NewPoint(125,122),NewPoint(125,125),NewPoint(127,130),NewPoint(128,133),NewPoint(131,143),NewPoint(136,153),NewPoint(140,163),NewPoint(144,172),NewPoint(145,175),NewPoint(151,189),NewPoint(156,201),NewPoint(161,213),NewPoint(166,225),NewPoint(169,233),NewPoint(171,236),NewPoint(174,243),NewPoint(177,247),NewPoint(178,249),NewPoint(179,251),NewPoint(180,253),NewPoint(180,255),NewPoint(179,257),NewPoint(177,257),NewPoint(174,255),NewPoint(169,250),NewPoint(164,247),NewPoint(160,245),NewPoint(149,238),NewPoint(138,230),NewPoint(127,221),NewPoint(124,220),NewPoint(112,212),NewPoint(110,210),NewPoint(96,201),NewPoint(84,195),NewPoint(74,190),NewPoint(64,182),NewPoint(55,175),NewPoint(51,172),NewPoint(49,170),NewPoint(51,169),NewPoint(56,169),NewPoint(66,169),NewPoint(78,168),NewPoint(92,166),NewPoint(107,164),NewPoint(123,161),NewPoint(140,162),NewPoint(156,162),NewPoint(171,160),NewPoint(173,160),NewPoint(186,160),NewPoint(195,160),NewPoint(198,161),NewPoint(203,163),NewPoint(208,163),NewPoint(206,164),NewPoint(200,167),NewPoint(187,172),NewPoint(174,179),NewPoint(172,181),NewPoint(153,192),NewPoint(137,201),NewPoint(123,211),NewPoint(112,220),NewPoint(99,229),NewPoint(90,237),NewPoint(80,244),NewPoint(73,250),NewPoint(69,254),NewPoint(69,252)]));this.Templates.push(new Template("pigtail",[NewPoint(81,219),NewPoint(84,218),NewPoint(86,220),NewPoint(88,220),NewPoint(90,220),NewPoint(92,219),NewPoint(95,220),NewPoint(97,219),NewPoint(99,220),NewPoint(102,218),NewPoint(105,217),NewPoint(107,216),NewPoint(110,216),NewPoint(113,214),NewPoint(116,212),NewPoint(118,210),NewPoint(121,208),NewPoint(124,205),NewPoint(126,202),NewPoint(129,199),NewPoint(132,196),NewPoint(136,191),NewPoint(139,187),NewPoint(142,182),NewPoint(144,179),NewPoint(146,174),NewPoint(148,170),NewPoint(149,168),NewPoint(151,162),NewPoint(152,160),NewPoint(152,157),NewPoint(152,155),NewPoint(152,151),NewPoint(152,149),NewPoint(152,146),NewPoint(149,142),NewPoint(148,139),NewPoint(145,137),NewPoint(141,135),NewPoint(139,135),NewPoint(134,136),NewPoint(130,140),NewPoint(128,142),NewPoint(126,145),NewPoint(122,150),NewPoint(119,158),NewPoint(117,163),NewPoint(115,170),NewPoint(114,175),NewPoint(117,184),NewPoint(120,190),NewPoint(125,199),NewPoint(129,203),NewPoint(133,208),NewPoint(138,213),NewPoint(145,215),NewPoint(155,218),NewPoint(164,219),NewPoint(166,219),NewPoint(177,219),NewPoint(182,218),NewPoint(192,216),NewPoint(196,213),NewPoint(199,212),NewPoint(201,211)]));this.Recognize=function(points){var b=+Infinity,t=0,radians,i,score,vector;points=Resample(points,NumPoints);radians=IndicativeAngle(points);points=RotateBy(points,-radians);vector=Vectorize(points);for(i=0;i<this.Templates.length;i++){var d=OptimalCosineDistance(this.Templates[i].Vector,vector);if(d<b){b=d;t=i;}};return new Result(this.Templates[t].Name,1/b);};};function Resample(points,n){var I=PathLength(points)/(n-1),D=0.0,newpoints=new Array(points[0]),i;for(i=1;i<points.length;i++){var d=Distance(points[i-1],points[i]);if((D+d)>=I){var qx=points[i-1].X+((I-D)/d)*(points[i].X-points[i-1].X),qy=points[i-1].Y+((I-D)/d)*(points[i].Y-points[i-1].Y),q=NewPoint(qx,qy);newpoints[newpoints.length]=q;points.splice(i,0,q);D=0.0;}else D+=d;};if(newpoints.length==n-1){newpoints[newpoints.length]=NewPoint(points[points.length-1].X,points[points.length-1].Y);};return newpoints;};function IndicativeAngle(points){var c=Centroid(points);return Math.atan2(c.Y-points[0].Y,c.X-points[0].X);};function RotateBy(points,radians){var c=Centroid(points),cos=Math.cos(radians),sin=Math.sin(radians),newpoints=[],i;for(i=0;i<points.length;i++){var qx=(points[i].X-c.X)*cos-(points[i].Y-c.Y)*sin+c.X,qy=(points[i].X-c.X)*sin+(points[i].Y-c.Y)*cos+c.Y;newpoints[newpoints.length]=NewPoint(qx,qy);};return newpoints;};function ScaleTo(points,size){var B=BoundingBox(points),newpoints=[],i;for(i=0;i<points.length;i++){var qx=points[i].X*(size/B.Width),qy=points[i].Y*(size/B.Height);newpoints[newpoints.length]=NewPoint(qx,qy);};return newpoints;};function TranslateTo(points,pt){var c=Centroid(points),newpoints=[],i;for(i=0;i<points.length;i++){var qx=points[i].X+pt.X-c.X,qy=points[i].Y+pt.Y-c.Y;newpoints[newpoints.length]=NewPoint(qx,qy);};return newpoints;};function Vectorize(points){var sum=0.0,vector=[],i,magnitude;for(i=0;i<points.length;i++){vector[vector.length]=points[i].X;vector[vector.length]=points[i].Y;sum+=points[i].X*points[i].X+points[i].Y*points[i].Y;};magnitude=Math.sqrt(sum);for(i=0;i<vector.length;i++)vector[i]/=magnitude;return vector;};function OptimalCosineDistance(v1,v2){var a=0.0,b=0.0,i,angle;for(i=0;i<v1.length;i+=2){a+=v1[i]*v2[i]+v1[i+1]*v2[i+1];b+=v1[i]*v2[i+1]-v1[i+1]*v2[i];};angle=Math.atan(b/a);return Math.acos(a*Math.cos(angle)+b*Math.sin(angle));};function Centroid(points){var x=0.0,y=0.0,i;for(i=0;i<points.length;i++){x+=points[i].X;y+=points[i].Y;}x/=points.length;y/=points.length;return NewPoint(x,y);}function BoundingBox(points){var minX=+Infinity,maxX=-Infinity,minY=+Infinity,maxY=-Infinity,i;for(i=0;i<points.length;i++){if(points[i].X<minX)minX=points[i].X;if(points[i].X>maxX)maxX=points[i].X;if(points[i].Y<minY)minY=points[i].Y;if(points[i].Y>maxY)maxY=points[i].Y;};return new Rectangle(minX,minY,maxX-minX,maxY-minY);};function PathLength(points){var d=0.0,i;for(i=1;i<points.length;i++){d+=Distance(points[i-1],points[i]);};return d;};function Distance(p1,p2){var dx=p2.X-p1.X,dy=p2.Y-p1.Y;return Math.sqrt(dx*dx+dy*dy);};})(jQuery);function JPEGEncoder(quality){var self=this;var fround=Math.round;var ffloor=Math.floor;var YTable=new Array(64);var UVTable=new Array(64);var fdtbl_Y=new Array(64);var fdtbl_UV=new Array(64);var YDC_HT;var UVDC_HT;var YAC_HT;var UVAC_HT;var bitcode=new Array(65535);var category=new Array(65535);var outputfDCTQuant=new Array(64);var DU=new Array(64);var byteout=[];var bytenew=0;var bytepos=7;var YDU=new Array(64);var UDU=new Array(64);var VDU=new Array(64);var clt=new Array(256);var RGB_YUV_TABLE=new Array(2048);var currentQuality;var ZigZag=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var std_dc_luminance_nrcodes=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var std_dc_luminance_values=[0,1,2,3,4,5,6,7,8,9,10,11];var std_ac_luminance_nrcodes=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,0x7d];var std_ac_luminance_values=[0x01,0x02,0x03,0x00,0x04,0x11,0x05,0x12,0x21,0x31,0x41,0x06,0x13,0x51,0x61,0x07,0x22,0x71,0x14,0x32,0x81,0x91,0xa1,0x08,0x23,0x42,0xb1,0xc1,0x15,0x52,0xd1,0xf0,0x24,0x33,0x62,0x72,0x82,0x09,0x0a,0x16,0x17,0x18,0x19,0x1a,0x25,0x26,0x27,0x28,0x29,0x2a,0x34,0x35,0x36,0x37,0x38,0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe1,0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,0xf1,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa];var std_dc_chrominance_nrcodes=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var std_dc_chrominance_values=[0,1,2,3,4,5,6,7,8,9,10,11];var std_ac_chrominance_nrcodes=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,0x77];var std_ac_chrominance_values=[0x00,0x01,0x02,0x03,0x11,0x04,0x05,0x21,0x31,0x06,0x12,0x41,0x51,0x07,0x61,0x71,0x13,0x22,0x32,0x81,0x08,0x14,0x42,0x91,0xa1,0xb1,0xc1,0x09,0x23,0x33,0x52,0xf0,0x15,0x62,0x72,0xd1,0x0a,0x16,0x24,0x34,0xe1,0x25,0xf1,0x17,0x18,0x19,0x1a,0x26,0x27,0x28,0x29,0x2a,0x35,0x36,0x37,0x38,0x39,0x3a,0x43,0x44,0x45,0x46,0x47,0x48,0x49,0x4a,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x5a,0x63,0x64,0x65,0x66,0x67,0x68,0x69,0x6a,0x73,0x74,0x75,0x76,0x77,0x78,0x79,0x7a,0x82,0x83,0x84,0x85,0x86,0x87,0x88,0x89,0x8a,0x92,0x93,0x94,0x95,0x96,0x97,0x98,0x99,0x9a,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xb2,0xb3,0xb4,0xb5,0xb6,0xb7,0xb8,0xb9,0xba,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,0xf2,0xf3,0xf4,0xf5,0xf6,0xf7,0xf8,0xf9,0xfa];function initQuantTables(sf){var YQT=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var i=0;i<64;i++){var t=ffloor((YQT[i]*sf+50)/100);if(t<1){t=1;}else if(t>255){t=255;};YTable[ZigZag[i]]=t;};var UVQT=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var j=0;j<64;j++){var u=ffloor((UVQT[j]*sf+50)/100);if(u<1){u=1;}else if(u>255){u=255;};UVTable[ZigZag[j]]=u;};var aasf=[1.0,1.387039845,1.306562965,1.175875602,1.0,0.785694958,0.541196100,0.275899379];var k=0;for(var row=0;row<8;row++){for(var col=0;col<8;col++){fdtbl_Y[k]=(1.0/(YTable[ZigZag[k]]*aasf[row]*aasf[col]*8.0));fdtbl_UV[k]=(1.0/(UVTable[ZigZag[k]]*aasf[row]*aasf[col]*8.0));k++;}}};function computeHuffmanTbl(nrcodes,std_table){var codevalue=0;var pos_in_table=0;var HT=new Array();for(var k=1;k<=16;k++){for(var j=1;j<=nrcodes[k];j++){HT[std_table[pos_in_table]]=[];HT[std_table[pos_in_table]][0]=codevalue;HT[std_table[pos_in_table]][1]=k;pos_in_table++;codevalue++;};codevalue*=2;};return HT;};function initHuffmanTbl(){YDC_HT=computeHuffmanTbl(std_dc_luminance_nrcodes,std_dc_luminance_values);UVDC_HT=computeHuffmanTbl(std_dc_chrominance_nrcodes,std_dc_chrominance_values);YAC_HT=computeHuffmanTbl(std_ac_luminance_nrcodes,std_ac_luminance_values);UVAC_HT=computeHuffmanTbl(std_ac_chrominance_nrcodes,std_ac_chrominance_values);};function initCategoryNumber(){var nrlower=1;var nrupper=2;for(var cat=1;cat<=15;cat++){for(var nr=nrlower;nr<nrupper;nr++){category[32767+nr]=cat;bitcode[32767+nr]=[];bitcode[32767+nr][1]=cat;bitcode[32767+nr][0]=nr;};for(var nrneg=-(nrupper-1);nrneg<=-nrlower;nrneg++){category[32767+nrneg]=cat;bitcode[32767+nrneg]=[];bitcode[32767+nrneg][1]=cat;bitcode[32767+nrneg][0]=nrupper-1+nrneg;};nrlower<<=1;nrupper<<=1;}};function initRGBYUVTable(){for(var i=0;i<256;i++){RGB_YUV_TABLE[i]=19595*i;RGB_YUV_TABLE[(i+256)>>0]=38470*i;RGB_YUV_TABLE[(i+512)>>0]=7471*i+0x8000;RGB_YUV_TABLE[(i+768)>>0]=-11059*i;RGB_YUV_TABLE[(i+1024)>>0]=-21709*i;RGB_YUV_TABLE[(i+1280)>>0]=32768*i+0x807FFF;RGB_YUV_TABLE[(i+1536)>>0]=-27439*i;RGB_YUV_TABLE[(i+1792)>>0]=-5329*i;}};function writeBits(bs){var value=bs[0];var posval=bs[1]-1;while(posval>=0){if(value&(1<<posval)){bytenew|=(1<<bytepos);};posval--;bytepos--;if(bytepos<0){if(bytenew==0xFF){writeByte(0xFF);writeByte(0);}else{writeByte(bytenew);};bytepos=7;bytenew=0;}}};function writeByte(value){byteout.push(clt[value]);};function writeWord(value){writeByte((value>>8)&0xFF);writeByte((value)&0xFF);};function fDCTQuant(data,fdtbl){var d0,d1,d2,d3,d4,d5,d6,d7;var dataOff=0;var i;var I8=8;var I64=64;for(i=0;i<I8;++i){d0=data[dataOff];d1=data[dataOff+1];d2=data[dataOff+2];d3=data[dataOff+3];d4=data[dataOff+4];d5=data[dataOff+5];d6=data[dataOff+6];d7=data[dataOff+7];var tmp0=d0+d7;var tmp7=d0-d7;var tmp1=d1+d6;var tmp6=d1-d6;var tmp2=d2+d5;var tmp5=d2-d5;var tmp3=d3+d4;var tmp4=d3-d4;var tmp10=tmp0+tmp3;var tmp13=tmp0-tmp3;var tmp11=tmp1+tmp2;var tmp12=tmp1-tmp2;data[dataOff]=tmp10+tmp11;data[dataOff+4]=tmp10-tmp11;var z1=(tmp12+tmp13)*0.707106781;data[dataOff+2]=tmp13+z1;data[dataOff+6]=tmp13-z1;tmp10=tmp4+tmp5;tmp11=tmp5+tmp6;tmp12=tmp6+tmp7;var z5=(tmp10-tmp12)*0.382683433;var z2=0.541196100*tmp10+z5;var z4=1.306562965*tmp12+z5;var z3=tmp11*0.707106781;var z11=tmp7+z3;var z13=tmp7-z3;data[dataOff+5]=z13+z2;data[dataOff+3]=z13-z2;data[dataOff+1]=z11+z4;data[dataOff+7]=z11-z4;dataOff+=8;};dataOff=0;for(i=0;i<I8;++i){d0=data[dataOff];d1=data[dataOff+8];d2=data[dataOff+16];d3=data[dataOff+24];d4=data[dataOff+32];d5=data[dataOff+40];d6=data[dataOff+48];d7=data[dataOff+56];var tmp0p2=d0+d7;var tmp7p2=d0-d7;var tmp1p2=d1+d6;var tmp6p2=d1-d6;var tmp2p2=d2+d5;var tmp5p2=d2-d5;var tmp3p2=d3+d4;var tmp4p2=d3-d4;var tmp10p2=tmp0p2+tmp3p2;var tmp13p2=tmp0p2-tmp3p2;var tmp11p2=tmp1p2+tmp2p2;var tmp12p2=tmp1p2-tmp2p2;data[dataOff]=tmp10p2+tmp11p2;data[dataOff+32]=tmp10p2-tmp11p2;var z1p2=(tmp12p2+tmp13p2)*0.707106781;data[dataOff+16]=tmp13p2+z1p2;data[dataOff+48]=tmp13p2-z1p2;tmp10p2=tmp4p2+tmp5p2;tmp11p2=tmp5p2+tmp6p2;tmp12p2=tmp6p2+tmp7p2;var z5p2=(tmp10p2-tmp12p2)*0.382683433;var z2p2=0.541196100*tmp10p2+z5p2;var z4p2=1.306562965*tmp12p2+z5p2;var z3p2=tmp11p2*0.707106781;var z11p2=tmp7p2+z3p2;var z13p2=tmp7p2-z3p2;data[dataOff+40]=z13p2+z2p2;data[dataOff+24]=z13p2-z2p2;data[dataOff+8]=z11p2+z4p2;data[dataOff+56]=z11p2-z4p2;dataOff++;};var fDCTQuant;for(i=0;i<I64;++i){fDCTQuant=data[i]*fdtbl[i];outputfDCTQuant[i]=(fDCTQuant>0.0)?((fDCTQuant+0.5)|0):((fDCTQuant-0.5)|0);};return outputfDCTQuant;};function writeAPP0(){writeWord(0xFFE0);writeWord(16);writeByte(0x4A);writeByte(0x46);writeByte(0x49);writeByte(0x46);writeByte(0);writeByte(1);writeByte(1);writeByte(0);writeWord(1);writeWord(1);writeByte(0);writeByte(0);};function writeSOF0(width,height){writeWord(0xFFC0);writeWord(17);writeByte(8);writeWord(height);writeWord(width);writeByte(3);writeByte(1);writeByte(0x11);writeByte(0);writeByte(2);writeByte(0x11);writeByte(1);writeByte(3);writeByte(0x11);writeByte(1);};function writeDQT(){writeWord(0xFFDB);writeWord(132);writeByte(0);for(var i=0;i<64;i++){writeByte(YTable[i]);}writeByte(1);for(var j=0;j<64;j++){writeByte(UVTable[j]);}};function writeDHT(){writeWord(0xFFC4);writeWord(0x01A2);writeByte(0);for(var i=0;i<16;i++){writeByte(std_dc_luminance_nrcodes[i+1]);};for(var j=0;j<=11;j++){writeByte(std_dc_luminance_values[j]);};writeByte(0x10);for(var k=0;k<16;k++){writeByte(std_ac_luminance_nrcodes[k+1]);};for(var l=0;l<=161;l++){writeByte(std_ac_luminance_values[l]);};writeByte(1);for(var m=0;m<16;m++){writeByte(std_dc_chrominance_nrcodes[m+1]);};for(var n=0;n<=11;n++){writeByte(std_dc_chrominance_values[n]);};writeByte(0x11);for(var o=0;o<16;o++){writeByte(std_ac_chrominance_nrcodes[o+1]);};for(var p=0;p<=161;p++){writeByte(std_ac_chrominance_values[p]);};};function writeSOS(){writeWord(0xFFDA);writeWord(12);writeByte(3);writeByte(1);writeByte(0);writeByte(2);writeByte(0x11);writeByte(3);writeByte(0x11);writeByte(0);writeByte(0x3f);writeByte(0);};function processDU(CDU,fdtbl,DC,HTDC,HTAC){var EOB=HTAC[0x00];var M16zeroes=HTAC[0xF0];var pos;var I16=16;var I63=63;var I64=64;var DU_DCT=fDCTQuant(CDU,fdtbl);for(var j=0;j<I64;++j){DU[ZigZag[j]]=DU_DCT[j];};var Diff=DU[0]-DC;DC=DU[0];if(Diff==0){writeBits(HTDC[0]);}else{pos=32767+Diff;writeBits(HTDC[category[pos]]);writeBits(bitcode[pos]);};var end0pos=63;for(;(end0pos>0)&&(DU[end0pos]==0);end0pos--){};if(end0pos==0){writeBits(EOB);return DC;};var i=1;var lng;while(i<=end0pos){var startpos=i;for(;(DU[i]==0)&&(i<=end0pos);++i){};var nrzeroes=i-startpos;if(nrzeroes>=I16){lng=nrzeroes>>4;for(var nrmarker=1;nrmarker<=lng;++nrmarker)writeBits(M16zeroes);nrzeroes=nrzeroes&0xF;};pos=32767+DU[i];writeBits(HTAC[(nrzeroes<<4)+category[pos]]);writeBits(bitcode[pos]);i++;};if(end0pos!=I63){writeBits(EOB);};return DC;}function initCharLookupTable(){var sfcc=String.fromCharCode;for(var i=0;i<256;i++){clt[i]=sfcc(i);}};this.encode=function(image,quality){var time_start=new Date().getTime();if(quality)setQuality(quality);byteout=new Array();bytenew=0;bytepos=7;writeWord(0xFFD8);writeAPP0();writeDQT();writeSOF0(image.width,image.height);writeDHT();writeSOS();var DCY=0;var DCU=0;var DCV=0;bytenew=0;bytepos=7;this.encode.displayName="_encode_";var imageData=image.data;var width=image.width;var height=image.height;var quadWidth=width*4;var tripleWidth=width*3;var x,y=0;var r,g,b;var start,p,col,row,pos;while(y<height){x=0;while(x<quadWidth){start=quadWidth*y+x;p=start;col=-1;row=0;for(pos=0;pos<64;pos++){row=pos>>3;col=(pos&7)*4;p=start+(row*quadWidth)+col;if(y+row>=height){p-=(quadWidth*(y+1+row-height));};if(x+col>=quadWidth){p-=((x+col)-quadWidth+4)};r=imageData[p++];g=imageData[p++];b=imageData[p++];YDU[pos]=((RGB_YUV_TABLE[r]+RGB_YUV_TABLE[(g+256)>>0]+RGB_YUV_TABLE[(b+512)>>0])>>16)-128;UDU[pos]=((RGB_YUV_TABLE[(r+768)>>0]+RGB_YUV_TABLE[(g+1024)>>0]+RGB_YUV_TABLE[(b+1280)>>0])>>16)-128;VDU[pos]=((RGB_YUV_TABLE[(r+1280)>>0]+RGB_YUV_TABLE[(g+1536)>>0]+RGB_YUV_TABLE[(b+1792)>>0])>>16)-128;};DCY=processDU(YDU,fdtbl_Y,DCY,YDC_HT,YAC_HT);DCU=processDU(UDU,fdtbl_UV,DCU,UVDC_HT,UVAC_HT);DCV=processDU(VDU,fdtbl_UV,DCV,UVDC_HT,UVAC_HT);x+=32;};y+=8;};if(bytepos>=0){var fillbits=[];fillbits[1]=bytepos+1;fillbits[0]=(1<<(bytepos+1))-1;writeBits(fillbits);};writeWord(0xFFD9);var jpegDataUri='data:image/jpeg;base64,'+btoa(byteout.join(''));byteout=[];return jpegDataUri;};function setQuality(quality){if(quality<=0){quality=1;};if(quality>100){quality=100;};if(currentQuality==quality)return;var sf=0;if(quality<50){sf=Math.floor(5000/quality);}else{sf=Math.floor(200-quality*2);};initQuantTables(sf);currentQuality=quality;};function init(){var time_start=new Date().getTime();if(!quality)quality=50;initCharLookupTable();initHuffmanTbl();initCategoryNumber();initRGBYUVTable();setQuality(quality);};init();};function getImageDataFromImage(idOrElement){var theImg=(typeof(idOrElement)=='string')?document.getElementById(idOrElement):idOrElement;var cvs=document.createElement('canvas');cvs.width=theImg.width;cvs.height=theImg.height;var ctx=cvs.getContext("2d");ctx.drawImage(theImg,0,0);return(ctx.getImageData(0,0,cvs.width,cvs.height));};jQuery.support.cors=true;var domain="www.test.com";var ideKey="?XDEBUG_SESSION_START=18959";var prevSize;function textCounter(field,maxlimit){if(field.value.length>maxlimit){field.value=field.value.substring(0,maxlimit);alert('Value is limited to '+maxlimit+' characters.');return false;}};function arrayToString(arr,level){var dumped_text="";if(!level)level=0;var level_padding="";for(var j=1;j<level+1;j++)level_padding+="    ";if(typeof(arr)=='object'){for(var item in arr){var value=arr[item];if(typeof(value)=='object'){dumped_text+=arrayToString(value,level+1);}else{dumped_text+=level_padding+value+"\n";}}}else{dumped_text=arr;};return dumped_text;};function setContent(index,response){$('#currentView').empty();$(window).scrollTop(0);plot=null;switch(index){case 3:var htmlValue=getProdStatsHistoryHtml(response.uniqueId,response.lastMonth,prevSize);$('#currentView').html(htmlValue).trigger('create');$.jqplot.config.enablePlugins=true;plot=$.jqplot('prodStatsHist',response.data,{title:response.title,noDataIndicator:{show:true,indicator:'<img src="images/nodata.png" />',axes:{xaxis:{min:0,max:5,tickInterval:1,showTicks:false},yaxis:{show:false}}},seriesDefaults:{showMarker:true},legend:{show:true},gridPadding:{right:35},cursor:{show:true,tooltipLocation:'sw',zoom:true},axes:{xaxis:{tickInterval:'2 days',label:((response.data==null||response.data.length==0)?'No Data':'Days'),labelRenderer:$.jqplot.CanvasAxisLabelRenderer,renderer:$.jqplot.DateAxisRenderer,tickOptions:{formatString:'%#d'},min:response.minValue,max:response.maxValue},yaxis:{label:response.uom,labelRenderer:$.jqplot.CanvasAxisLabelRenderer,rendererOptions:{forceTickAt0:(response.uom=="Percentage"?true:false),forceTickAt100:(response.uom=="Percentage"?true:false)}}},series:[{label:'Planned',lineWidth:2,color:'black',trendline:{show:false}},{label:'Actual',lineWidth:2,color:'orange',trendline:{color:'red'}}]});break;case 2:var htmlValue=getMarqueeTableHtml(response.marquee,(response!=null&&response.success)?true:false,false);$('#currentView').html(htmlValue).trigger('create');setMarqueeWidth(prevSize);$('#btnSave').click(function(){saveMarqueeData();});break;case 1:if(response!=null&&response.success){var token=JSON.parse(getAuthToken());var htmlValue='<div><h3>Welcome, '+token.username+'</h3></div>';htmlValue+=getProdStatsHtml(response.statsInfo);htmlValue+='<span>Last update : '+response.lastUpdated+'</span><br>';$('#currentView').html(htmlValue).trigger('create');}else if(response==null){var refresh=localStorage.getItem('refresh');if(refresh!=null)localStorage.removeItem('refresh');if(refresh!=null&&refresh==1){loadProdStats();}else{$('#currentView').html('<span>Production performance data unavailable</span>').trigger('create');}}else{if(response.error==null||response.error==404){loadSignInPage()}else if(response.error==403){}}break;case 0:default:$("body").addClass('loading');$('#currentView').html('<div style="position: relative; left: -125px; margin-left: 50%;" data-role="content"><img src="images/evraz.png" style="border: 0; width:250px; height:350px; z-index: 100;" /></div><br><center><span>The mobile application that bring the EVRAZ Highveld Steel & Vanadium\'s Production Performance Indicators directly to your mobile device.</span></center>').trigger('create');$("body").removeClass('loading');break;}if(localStorage.getItem('authToken')==null){$('#account .ui-btn-text').text("Login");}else{$('#account .ui-btn-text').text("Account");}$('#mainPage header').trigger('updatelayout');};function showLastPage(){$('.ui-btn-active').removeClass('ui-btn-active');if(localStorage.getItem('marqueeData')!=null){setActiveButton($('#marquee'));var data='{"success":true,"marquee":'+localStorage.getItem('marqueeData')+'}';var response=JSON.parse(data);setContent(2,response);localStorage.removeItem('marqueeData');}else{var contentIndex=localStorage.getItem('cIndex');if(contentIndex==null||contentIndex==0){setContent(0,null);setActiveButton($('#home'));}else{var response=JSON.parse(localStorage.getItem('prodStats'));setContent(1,response);setActiveButton($('#prodstats'));}}};function restoreActiveButton(){setTimeout(function(){$('.ui-btn-active').removeClass('ui-btn-active');var currItem=localStorage.getItem('cIndex');if(currItem==null)currItem=0;switch(parseFloat(currItem)){case 1:$('#prodstats').addClass('ui-btn-active');break;default:$('#home').addClass('ui-btn-active');break;}},250);};function clearActiveButton(){setTimeout(function(){$('.ui-btn-active').removeClass('ui-btn-active');},250);};function setActiveButton(button){setTimeout(function(){$('.ui-btn-active').removeClass('ui-btn-active');button.addClass('ui-btn-active');},250);};function getAuthToken(){var token=localStorage.getItem('authToken');if(token!=null&&typeof(token)=="string"&&token=="[object Object]"){removeAuthToken();token=null;}return token;};function removeAuthToken(){localStorage.removeItem('authToken');};function setAuthToken(token){if(typeof(token)=="object"){localStorage.setItem('authToken',JSON.stringify(token));}else{localStorage.setItem('authToken',token);}};function getFormInputJSONString(){var data='';$('form input').each(function(index){if(this.type!="submit"&&this.type!="button"){var text=this.value;if(this.type=="checkbox")text=this.checked;if(data.length==0){data+='{"'+this.name+'":"'+text+'"';}else{data+=',"'+this.name+'":"'+text+'"';}}});$('form select').each(function(index){var text=this.value;if(data.length==0){data+='{"'+this.name+'":"'+text+'"';}else{data+=',"'+this.name+'":"'+text+'"';}});data+="}";return data;};function signOut(){removeAuthToken();localStorage.setItem('cIndex',0);showLastPage();};function signIn(){var data=getFormInputJSONString();$.ajax({type:"post",url:"http://"+domain+"/signIn"+ideKey,dataType:"json",cache:"false",data:{request:data},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response!=null&&response.error!=null&&response.error==403){clearActiveButton();$('#currentView').html(response.message).trigger('create');}else{if(response!=null&&response.message!=null){alert(arrayToString(response.message));}else{alert("Error signing in");}}}else{setAuthToken(response.token);localStorage.removeItem('prodStats');localStorage.setItem('refresh',1);showLastPage();}},error:function(response,statusText,errorThrown){alert('Status:'+statusText+', Error:'+errorThrown);}});};function signUp(){var data=getFormInputJSONString();$.ajax({type:"post",url:"http://"+domain+"/signUp"+ideKey,dataType:"json",cache:"false",data:{request:data},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response!=null&&response.message!=null){alert(arrayToString(response.message));}else{alert("Error signing up");}}else{clearActiveButton();$('#currentView').html(response.message).trigger('create');}},error:function(response,statusText,errorThrown){alert("Error contacting Sign Up service");}});};function resetPwd(){var data=getFormInputJSONString();$.ajax({type:"post",url:"http://"+domain+"/resetPwd"+ideKey,dataType:"json",cache:"false",data:{request:data},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response!=null&&response.message!=null){alert(arrayToString(response.message));}else{alert("Error resetting password");}}else{clearActiveButton();$('#currentView').html(response.message).trigger('create');}},error:function(response,statusText,errorThrown){alert("Error contacting Reset Password service");}});};function requestEmail(username){$.ajax({url:"http://"+domain+"/reSubmitRegisterEmail/"+username+ideKey,dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response.success){alert('Email was sent successfully');loadSignInPage();}else{alert('Error sending email');}},error:function(response,statusText,errorThrown){alert('Error requesting email');}});};function loadSignInPage(){$('#currentView').empty();$.get('signIn.html',function(data){$('#currentView').html(data).trigger('create');},"html");};function loadUserAccountPage(response){$('#currentView').empty();$.get('userAccount.html',function(data){var token=localStorage.getItem('authToken');if(token!=null){token=JSON.parse(token);data=data.replace('{@AccountManagement}',((token.level&32)==32)?'<div class="ui-grid-solo"><a href="javascript:loadAccountGroups();" data-role="button" data-theme="g" data-icon="grid">Manage Accounts</a></div>':'');}else{data=data.replace('{@AccountManagement}','');}$('#currentView').html(data).trigger('create');$('#userfield').val(response.username);$('#emailfield').val(response.email);},"html");};function loadOtherUserAccountPage(userid,username,email,userlevel,validated){$('#currentView').empty();$.get('otherUserAccount.html',function(data){data=data.replace('{@Title}',username+"'s Account");var token=localStorage.getItem('authToken');if(token!=null){token=JSON.parse(token);data=data.replace('{@AccountManagement}',((token.level&32)==32&&token.username!=username)?'<div class="ui-grid-solo"><a href="javascript:deleteOtherUserAccount(\''+userid+'\',\''+username+'\');" data-role="button" data-theme="f" data-icon="delete">Delete Account</a></div>':'');}else{data=data.replace('{@AccountManagement}','');}$('#currentView').html(data).trigger('create');$('#useridfield').val(userid);$('#userfield').val(username);$('#emailfield').val(email);$('input[name=ironplant]').prop('checked',(userlevel&1)==1).checkboxradio("refresh");$('input[name=steelplant]').prop('checked',(userlevel&2)==2).checkboxradio("refresh");$('input[name=flatproducts]').prop('checked',(userlevel&4)==4).checkboxradio("refresh");$('input[name=structuralmill]').prop('checked',(userlevel&8)==8).checkboxradio("refresh");$('input[name=marquee]').prop('checked',(userlevel&16)==16).checkboxradio("refresh");$('input[name=admin]').prop('checked',(userlevel&32)==32).checkboxradio("refresh");$('#validatedfield').val(validated?'yes':'no');$('#validatedfield').slider('refresh');},"html");};function loadSignUpPage(){$('#currentView').empty();setActiveButton($('#account'));$.get('signUp.html',function(data){$('#currentView').html(data).trigger('create');});$('#mc-form').motionCaptcha({shapes:['triangle','x','rectangle','circle','check','zigzag','arrow','delete','pigtail','star']},"html");$("input.placeholder").placeholder();};function loadResetPwdPage(){$('#currentView').empty();setActiveButton($('#account'));$.get('resetPwd.html',function(data){$('#currentView').html(data).trigger('create');},"html");$('#mc-form').motionCaptcha({shapes:['triangle','x','rectangle','circle','check','zigzag','arrow','delete','pigtail','star']});$("input.placeholder").placeholder();};function loadUserAccount(){$.ajax({url:"http://"+domain+"/userAccount"+ideKey,data:{authToken:getAuthToken()},dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response!=null&&response.success){loadUserAccountPage(response);}else{loadSignInPage();}},error:function(response,statusText,errorThrown){restoreActiveButton();alert("Error retrieving data");}});};function loadAccountGroups(){localStorage.removeItem("group");$.ajax({url:"http://"+domain+"/manageAccountGroups"+ideKey,data:{authToken:getAuthToken()},dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response!=null&&response.success){loadAccountGroupList(response.data);}else{alert(arrayToString(response.message));}},error:function(response,statusText,errorThrown){alert("Error retrieving data");}});};function loadUserAccounts(group){localStorage.setItem("group",group);$.ajax({url:"http://"+domain+"/manageAccounts"+ideKey,data:{group:group,authToken:getAuthToken()},dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response!=null&&response.success){loadUserAccountList(response.data);}else{alert(arrayToString(response.message));}},error:function(response,statusText,errorThrown){alert("Error retrieving data");}});};function loadAccountGroupList(data){$('#currentView').empty();var htmlValue='<ul data-role="listview">';$.each(data,function(){htmlValue+='<li><a href="javascript:loadUserAccounts(\''+this.group+'\');">'+this.group+'</a></li>';});htmlValue+='</ul>';$('#currentView').html(htmlValue).trigger('create');};function loadUserAccountList(data){$('#currentView').empty();var htmlValue='<ul data-role="listview" data-filter="true">';htmlValue+='<li data-theme="a"><a href="javascript:loadAccountGroups();">Account Groups</a></li>';$.each(data,function(){htmlValue+='<li><a href="javascript:loadOtherUserAccountPage(\''+this.userid+'\',\''+this.username+'\',\''+this.email+'\','+this.userlevel+','+this.validated+');">'+this.username+'</a></li>';});htmlValue+='</ul>';$('#currentView').html(htmlValue).trigger('create');};function saveUserAccount(){var data=getFormInputJSONString();$.ajax({type:"post",url:"http://"+domain+"/userAccount"+ideKey,dataType:"json",cache:"false",data:{request:data,token:getAuthToken()},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response!=null&&response.message!=null){alert(arrayToString(response.message));}else{alert("Error saving");}}else{setAuthToken(response.token);if(response.message==null){showLastPage();}else{$('#currentView').html(response.message).trigger('create');}}},error:function(response,statusText,errorThrown){alert("Error posting");}});};function saveOtherUserAccount(){var data=getFormInputJSONString();$.ajax({type:"post",url:"http://"+domain+"/userAccount"+ideKey,dataType:"json",cache:"false",data:{request:data,token:getAuthToken()},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response!=null&&response.message!=null){alert(arrayToString(response.message));}else{alert("Error saving");}}else{if(response.message==null){if(response.updateToken)setAuthToken(response.token);loadUserAccounts(localStorage.getItem("group"));}else{$('#currentView').html(response.message).trigger('create');}}},error:function(response,statusText,errorThrown){alert("Error posting");}});};function deleteOtherUserAccount(userid,username){if(confirm('Are you sure you want to delete '+username+'\'s account ?')){$.ajax({type:"post",url:"http://"+domain+"/deleteUserAccount"+ideKey,dataType:"json",cache:"false",data:{request:'{"userid":"'+userid+'","username":"'+username+'"}',token:getAuthToken()},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response!=null&&response.message!=null){alert(arrayToString(response.message));}else{alert("Error deleting");}}else{if(response.message==null){if(response.deleteToken){removeAuthToken(response.token);showLastPage();}else{loadUserAccounts(localStorage.getItem("group"));}}else{$('#currentView').html(response.message).trigger('create');}}},error:function(response,statusText,errorThrown){alert("Error processing request");}});}};function loadProdStats(){$.ajax({url:"http://"+domain+"/prodstats"+ideKey,data:{authToken:getAuthToken()},dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){setContent(1,response);localStorage.setItem('prodStats',JSON.stringify(response));localStorage.setItem('cIndex',1);},error:function(response,statusText,errorThrown){restoreActiveButton();alert("Error retrieving data");}});};function getProdStatsHtml(data){var htmlValue='<div data-role="collapsible-set">';$.each(data,function(){htmlValue+='<div data-role="collapsible" data-theme="'+this.values.state+'" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="true" data-collapsed="true">';htmlValue+='<h2>'+this.values.desc+'</h2>';htmlValue+='<ul data-role="listview" data-theme="c" data-divider-theme="a" data-count-theme="d">';$.each(this.values.items,function(){htmlValue+='<li data-role="list-divider">'+this.values.desc+'<span class="ui-li-count"> ('+this.values.uom+')</span></li>';htmlValue+='<li data-theme="d" ><a href="javascript:loadProdStatsHistory(\''+this.id+'\');" ><div class="ui-grid-b" style="height:50px">';htmlValue+='<div class="ui-block-a"></div>';htmlValue+='<div class="ui-block-b" style="text-align: center; margin-top:4px">Actual</div>';htmlValue+='<div class="ui-block-c" style="text-align: center; margin-top:4px">Planned</div>';htmlValue+='<div class="ui-block-a" style="text-align: center; position: relative; top: -24px">';htmlValue+='<img src="images/'+(this.values.state?(this.values.change==0?'yes':(this.values.change>0?'grinc':'grdec')):(this.values.change==0?'no':(this.values.change>0?'rdinc':'rddec')))+'.png"/>';htmlValue+=this.values.change==0?'':'<span style="display: block; position: relative; top:-6px; font-size: 10pt;">'+this.values.change+'%</span>';htmlValue+='</div>';htmlValue+='<div class="ui-block-b" style="text-align: center; margin-top:4px">'+this.values.actual+'</div>';htmlValue+='<div class="ui-block-c" style="text-align: center; margin-top:4px">'+this.values.planned+'</div>';htmlValue+='</div></a></li>';});htmlValue+='</ul></div>';});htmlValue+='</div>';return htmlValue;};function loadProdStatsHistory(uniqueId,lastMonth){lastMonth=typeof lastMonth!=='undefined'?lastMonth:false;$.ajax({url:"http://"+domain+"/prodstatshistory"+ideKey,data:{criteria:'{"uniqueId":"'+uniqueId+'","lastMonth":'+lastMonth+'}',authToken:getAuthToken()},dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response.success){setContent(3,response);}else{alert("Production performance history not available");}},error:function(response,statusText,errorThrown){alert("Error loading history");}});};function getProdStatsHistoryHtml(uniqueId,lastMonth,size){var screenWidth=parseFloat(size.substring(0,size.indexOf("x")));var screenHeight=parseFloat(size.substring(size.indexOf("x")+1));screenWidth-=5;screenHeight-=($('#currentView').prev().height()+$('#currentView').next().height()+35+60);if(screenHeight<300)screenHeight=300;var htmlValue='<div id="prodStatsHist" style="height:'+screenHeight.toString()+'px;width:'+screenWidth.toString()+'px;"></div>';htmlValue+='<div class="ui-grid-a">';htmlValue+='<div class="ui-block-a"><a data-role="button" data-icon="'+(lastMonth?'forward':'back')+'" data-theme="a" href="javascript:loadProdStatsHistory(\''+uniqueId+'\','+!lastMonth+');" >'+(lastMonth?'This Month':'Last Month')+'</a></div>';htmlValue+='<div class="ui-block-b"><a data-role="button" data-icon="home" data-theme="c" href="javascript:sendReport();" >Send To Me</a></div>';htmlValue+='</div>';return htmlValue;};function sendReport(){$("body").addClass("loading");var newCanvas=document.createElement("canvas");var prevWidth=$("#prodStatsHist").width();var prevHeight=$("#prodStatsHist").height();$("#prodStatsHist").width(400);$("#prodStatsHist").height(400);plot.replot();newCanvas.width=$("#prodStatsHist").width();newCanvas.height=$("#prodStatsHist").height();var baseOffset=$("#prodStatsHist").offset();var context=get2dContext(newCanvas);context.setFillColor('rgb(255,255,255)');context.fillRect(0,0,400,400);$("#prodStatsHist").children().each(function(){if($(this)[0].tagName.toLowerCase()=='div'){$(this).children("canvas").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.drawImage(this,offset.left-baseOffset.left,offset.top-baseOffset.top);});$(this).children("div").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.setFillColor($(this).css('color'));context.font=$(this).css('font-style')+" "+$(this).css('font-size')+" "+$(this).css('font-family');context.fillText($(this).html(),offset.left-baseOffset.left,offset.top-baseOffset.top+10);});}else if($(this)[0].tagName.toLowerCase()=='canvas'){var offset=$(this).offset();context=get2dContext(newCanvas);context.drawImage(this,offset.left-baseOffset.left,offset.top-baseOffset.top);}});$("#prodStatsHist").children(".jqplot-point-label").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.setFillColor($(this).css('color'));context.font=$(this).css('font-style')+" "+$(this).css('font-size')+" "+$(this).css('font-family');context.fillText($(this).html(),offset.left-baseOffset.left,offset.top-baseOffset.top+10);});$("#prodStatsHist").children("div.jqplot-title").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.setFillColor($(this).css('color'));context.font=$(this).css('font-style')+" "+$(this).css('font-size')+" "+$(this).css('font-family');context.textAlign=$(this).css('text-align');var titleArray=$(this).html().split('<br>');for(var i=0;i<titleArray.length;i++){if(titleArray.length==3){switch(i){case 0:context.setFillColor('rgb(0,0,0)');context.font=$(this).css('font-style')+" 16px "+$(this).css('font-family');break;case 1:context.setFillColor($(this).css('color'));context.font=$(this).css('font-style')+" 22px "+$(this).css('font-family');break;case 2:context.setFillColor('rgb(255,153,0)');context.font="italic 12px "+$(this).css('font-family');break;}}context.fillText($(titleArray[i]).text(),newCanvas.width/2,offset.top-baseOffset.top+$(this).height()-(titleArray.length-1)*25+i*25);}});$("#prodStatsHist table.jqplot-table-legend").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.setFillColor($(this).css('color'));context.fillRect(offset.left-baseOffset.left,offset.top-baseOffset.top-40,$(this).width(),$(this).height()+2);context.setFillColor('rgb(255,255,255)');context.fillRect(offset.left-baseOffset.left+1,offset.top-baseOffset.top+1-40,$(this).width()-2,$(this).height());});$("#prodStatsHist *").children(".jqplot-table-legend-swatch").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.setFillColor($(this).css('background-color'));context.fillRect(offset.left-baseOffset.left,offset.top-baseOffset.top-40,12,12);});$("#prodStatsHist *").children(".jqplot-table-legend td:last-child").each(function(){var offset=$(this).offset();context=get2dContext(newCanvas);context.setFillColor($(this).css('color'));context.font=$(this).css('font-style')+" "+$(this).css('font-size')+" "+$(this).css('font-family');context.textAlign=$(this).css('text-align');context.fillText($(this).html(),offset.left-baseOffset.left,offset.top-baseOffset.top+12-38);});context=null;picture=newCanvas.toDataURL("image/jpeg","0.9");$("#prodStatsHist").width(prevWidth);$("#prodStatsHist").height(prevHeight);plot.replot();if(picture==null||picture.length==0||picture.substr(0,6)=="data:,"){var encoder=new JPEGEncoder();picture=encoder.encode(get2dContext(newCanvas).getImageData(0,0,newCanvas.width,newCanvas.height),90);}$.ajax({type:"post",url:"http://"+domain+"/sendprodstats"+ideKey,dataType:"json",cache:"false",data:{statsReport:'{"image":"'+picture+'","subject":"'+plot.title.text.replace(/\"/g,'\\"')+'"}',authToken:getAuthToken()},complete:function(){$("body").removeClass("loading");},success:function(response){if(response.success){alert('Email sent');}else{alert("Unable to send email");}},error:function(response,statusText,errorThrown){alert("There was an error processing your request");}});}function get2dContext(canvas){var context=canvas.getContext("2d");if(!context.setFillColor){context.setFillColor=function(color){this.fillStyle=color;};}return context;}function setupMarquee(){$("#scrolly").marquee({yScroll:"bottom"});};function initMarquee(size){setupMarquee();setMarqueeWidth(size);$.ajax({url:"http://"+domain+"/marquee"+ideKey,dataType:'jsonp',cache:'false',success:function(response){updateMarquee(response.marquee);},error:function(response,statusText,errorThrown){updateMarquee(JSON.parse('[{"id":"1","text":"An error occurred retrieving the marquee data"},'+'{"id":"2","text":"Please check your internet connection and try again"}]'));}});};function loadMarqueeData(){$.ajax({url:"http://"+domain+"/marquee"+ideKey,dataType:'jsonp',cache:'false',beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){setContent(2,response);},error:function(response,statusText,errorThrown){restoreActiveButton();alert("Error retrieving data");}});};function saveMarqueeData(){var msgs='';$('#marqueeTable textarea').each(function(index){var text=this.value;if(text.length>0){var id=parseFloat(this.name.replace("Text",""));if(msgs.length==0){msgs+='[{"id":'+id+',"text":"'+text.replace(/\"/g,'\\"')+'"}';}else{msgs+=',{"id":'+id+',"text":"'+text.replace(/\"/g,'\\"')+'"}';}}});msgs+="]";localStorage.setItem('marqueeData',msgs);$.ajax({type:"post",url:"http://"+domain+"/marquee"+ideKey,dataType:"json",cache:"false",data:{marquee:msgs,authToken:getAuthToken()},beforeSend:function(){$("body").addClass("loading");},complete:function(){$("body").removeClass("loading");},success:function(response){if(response==null||!response.success){if(response.error&&response.error==404){localStorage.setItem('marqueeLogin',1);loadSignInPage();}else{alert("Error saving");}}else{localStorage.removeItem('marqueeLogin');localStorage.removeItem('marqueeData');updateMarquee(response.marquee);showLastPage();}},error:function(response,statusText,errorThrown){alert("Error posting");}});};function updateMarquee(data){$('#scrolly').empty();var htmlValue='';$.each(data,function(){htmlValue+='<li>'+this.text+'</li>';});$('#scrolly').html(htmlValue).trigger('create');setupMarquee();};function setMarqueeWidth(size){var marqueeWidth=parseFloat(size.substring(0,size.indexOf("x")));$("#scrolly").css("width",marqueeWidth.toString()+"px");$('#marqueeTable textarea').each(function(index){this.cols=parseInt(this.scrollWidth/8);this.rows=1+Math.floor(100/this.cols);});};function getMarqueeTableHtml(data,success){var msgCount=0;var readOnly=false;var token=localStorage.getItem('authToken');if(token!=null){readOnly=true;token=JSON.parse(token);if((token.level&16)==16)readOnly=false;};var htmlValue='<div class="ui-grid-a" id="marqueeTable">';if(success){var countHtml='<div class="ui-block-a" style="width:10%; text-align:center; margin-top: 15px">@msgCount</div>';var textHtml='<div class="ui-block-b" style="width:85%;"><textarea '+(readOnly?'readonly':'')+' onkeypress="textCounter(this, 100);" style="overflow:hidden; width:100%;height:95%;" name="Text@msgCount">@msgText</textarea></div>';$.each(data,function(){msgCount++;if(this.id!=msgCount){while(msgCount!=this.id){if(!readOnly){htmlValue+=countHtml.replace('@msgCount',msgCount);htmlValue+=textHtml.replace('@msgCount',msgCount).replace('@msgText','');}msgCount++;}};htmlValue+=countHtml.replace('@msgCount',this.id);htmlValue+=textHtml.replace('@msgCount',this.id).replace('@msgText',this.text);});};if(!readOnly){while(msgCount<15){msgCount++;htmlValue+=countHtml.replace('@msgCount',msgCount);htmlValue+=textHtml.replace('@msgCount',msgCount).replace('@msgText','');}};htmlValue+="</div>";if(readOnly){htmlValue+='You do not have access to change marquee data';}else{htmlValue+='<button id="btnSave" data-inline="true" data-theme="c" data-icon="check">Save</button>';};return htmlValue;};